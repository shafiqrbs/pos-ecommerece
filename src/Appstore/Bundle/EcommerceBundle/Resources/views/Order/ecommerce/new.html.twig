{% extends '::base.html.twig' %}
{% block body %}
    <div class="container-fluid">
        <!-- BEGIN PAGE HEADER-->
        <div class="row-fluid">
            <div class="span12">
                <h3 class="page-title">
                    Manage Order
                </h3>
                <ul class="breadcrumb">
                    <li>
                        <i class="icon-home"></i>
                        <a href="{{ path('homepage') }}">Home</a>
                        <span class="icon-angle-right"></span>
                    </li>
                    <li>
                        <a href="{{ path('customer_order') }}">Manage Order</a>
                        <span class="icon-angle-right"></span>
                    </li>
                    <li><a href="#">Manage Order Lists</a></li>
                    <li class="pull-right btn blue disabled mini">
                        <i class="fa fa-calendar"></i>
                        {{ "now"|date("d-F-Y") }}
                    </li>
                </ul>
            </div>
        </div>
        <!-- END PAGE HEADER-->
        <!-- BEGIN PAGE CONTENT-->
        <div class="row-fluid">
            <div class="span12">
                <div class="portlet box green">

                    <div class="portlet-title">
                        <div class="caption"><i class="icon-reorder"></i>Manage Order Information</div>
                        <div class="actions">
                            <div class="btn-group">
                                <a class="btn yellow" href="{{ path('customer_order') }}"><i class="icon-th-list"></i>&nbsp;Orders</a>
                            </div>
                        </div>
                    </div>
                    <div class="portlet-body form">
                        <div class="row-fluid">
                            <div class="span8">
                                <div class="row-fluid">
                                    <div class="span12">
                                        <ul class="unstyled">
                                            <li><strong class="span2" >Name</strong>
                                                <span class="span10">{{ entity.customer.name }}</span>
                                            </li>
                                            <li><strong class="span2" >Mobile</strong>
                                                <span class="span10">{{ entity.customerMobile }}</span>
                                            </li>
                                            <li><strong class="span2" >Designation</strong>
                                                <span class="span10">{{ entity.customer.profession }}</span>
                                            </li>
                                            <li><strong class="span2" >Department</strong>
                                                <span class="span10">{{ entity.customer.department }}</span>
                                            </li>
                                            <li><strong class="span2" >Line</strong>
                                                <span class="span10">{{ entity.customer.line }}</span>
                                            </li>
                                            <li><strong class="span2" >Section</strong>
                                                <span class="span10">{{ entity.customer.section }}</span>
                                            </li>
                                            <li><strong class="span2" >Unit</strong>
                                                <span class="span10">{{ entity.customer.unit }}</span>
                                            </li>
                                            <li><strong class="span2" >Category</strong>
                                                <span class="span10">{{ entity.customer.category }}</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="span4">
                                <div class="row-fluid">
                                    <div class="span12">
                                        <label><strong>Process Details</strong></label>
                                        <ul class="unstyled" >
                                            <li><strong class="span4" >Credit Limit</strong>
                                                <span class="span8">{% if entity.customer %}{{ entity.customer.creditLimit }}{% endif %}</span>
                                            </li>
                                            <li><strong class="span4" >Available Credit</strong>
                                                <span class="span8">{{ currentCredit|number_format }}</span>
                                            </li>
                                            <li><strong class="span4" >Delivery Date</strong>
                                                <span class="span8">{{ entity.deliveryDate|date('Y-m-d') }}</span>
                                            </li>
                                            <li><strong class="span4" >Delivery Period</strong>
                                                <span class="span8">{% if entity.timePeriod is not empty %}{{ entity.timePeriod.name }}{% endif %}</span>
                                            </li>
                                            <li><strong class="span4">Process Status</strong>
                                                <span class="span8">{{ entity.process }}</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"> </div>
                        <div class="form-actions portlet box red">
                            <div class="portlet-title"><div class="caption"><i class="icon-reorder"></i>Add Order Item</div></div>
                        </div>
                        <div class="clearfix"><br/> </div>
                        {{ form_start(salesItem) }}
                        {{ form_row(salesItem._token) }}
                        <div class="row-fluid particular-info" style="padding-left:15px!important; margin-left: -10px!important;" >
                            <div class="span8">
                                {{ form_widget(salesItem.itemName) }}
                                {{ form_errors(salesItem.itemName) }}
                            </div>
                            <div class="span4">
                                <div class="input-append">
                                    <div class="input-group">
                                        {{ form_widget(salesItem.quantity) }}
                          \              {{ form_widget(salesItem.price) }}
                                        <button type="button" class="btn yellow" id="unit">Unit</button>
                                        <button type="button" class="btn blue" id="addOrderItem"> <span class="fa fa-shopping-cart"></span> Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {{ form_end(salesItem) }}
                        <div class="row-fluid">
                            <div class="span8">
                                <div class="portlet-body flip-scroll">
                                    <div class="clearfix">&nbsp;</div>
                                    <table class="table table-bordered table-striped table-condensed flip-content ">
                                        <thead class="flip-content ">
                                        <tr class="head-grey">
                                            <th class="numeric" ><i class="icon-reorder"></i></th>
                                            <th class="numeric" >Item</th>
                                            <th class="numeric" >Brand</th>
                                            <th class="numeric" >Category</th>
                                            <th class="numeric" >Quantity</th>
                                            <th class="numeric" >MRP</th>
                                            <th class="numeric span2" >Total Price</th>
                                            <th class="numeric" >Action</th>
                                        </tr>
                                        </thead>
                                        <tbody id="orderItems">
                                        {% for orderItem in entity.orderItems %}
                                            <tr id="remove-{{ orderItem.id }}">
                                                <input type="hidden" name="itemId[]" value="{{ orderItem.id }}">
                                                <td>{{ loop.index }}.</td>
                                                <td class="numeric" >{{ orderItem.itemName }}</td>
                                                <td class="numeric" >{{ orderItem.brandName }}</td>
                                                <td class="numeric" >{{ orderItem.categoryName }}</td>
                                                <td class="numeric" >
                                                    {% if entity.process in ['created','confirm','wfc']  %}
                                                        <input type="text"  name="quantity" data-action="{{ path('customer_medicine_item_update',{'order':entity.id,'id':orderItem.id}) }}" id="quantity-{{ orderItem.id }}" class="form-control m-wrap-custom input-number" value="{{ orderItem.quantity }}" min="1" max="1000" >
                                                        {% if orderItem.UnitName is not empty %}
                                                            <button type="button" class="btn mini yellow">{{ orderItem.UnitName }}</button>
                                                        {% endif %}
                                                    {% else %}
                                                        {{ orderItem.quantity }}
                                                    {% endif %}
                                                </td>
                                                <td class="numeric" >{{ orderItem.price }}</td>
                                                <td class="numeric" ><strong>{{ orderItem.subTotal }}</strong></td>
                                                <td class="numeric" >
                                                    {% if entity.process in ['created','confirm','wfc']  %}
                                                        <div class="btn-group">
                                                            <a data-id="{{ orderItem.id }}" data-url="{{ path('customer_medicine_item_update',{'order':entity.id,'id':orderItem.id}) }}" data-value="{{ globalOption.slug }}" class="btn blue mini orderItemProcess" ><i class="icon-save"></i></a>
                                                            <a  data-id="{{ orderItem.id }}" data-url="{{ path('customer_medicine_item_delete',{'order':entity.id,'id':orderItem.id}) }}" data-value="{{ globalOption.slug }}" class="btn mini red item-remove" ><i class="icon-trash"></i></a>
                                                        </div>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        <tr>
                                            <td class="numeric" colspan="6" ><span class="pull-right"><strong>Sub-Total</strong></span></td>
                                            <td class="numeric" id="">{{ entity.subTotal }}</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="numeric" colspan="6" ><span class="pull-right"><strong>Discount</strong></span></td>
                                            <td class="numeric" id="discount">{{ entity.discount }}</td>
                                            <td></td>
                                        </tr>
                                        {% if entity.coupon is not empty %}
                                            <tr>
                                                <td class="numeric" colspan="6" ><span class="pull-right">Coupon Code({{ entity.coupon.couponCode }})</span></td>
                                                <td class="numeric">{{ entity.couponAmount }}</td>
                                                <td></td>
                                            </tr>
                                        {% endif %}
                                        <tr>
                                            <td class="numeric" colspan="6" ><span class="pull-right"><strong>Grand Total</strong></span></td>
                                            <td class="numeric"><strong id="total">{{ ( entity.total)|number_format }}</strong></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="numeric" colspan="6" ><span class="pull-right"><strong>Paid Amount</strong></span></td>
                                            <td class="numeric"><strong id="receive">{{ ( entity.paidAmount)|number_format }}</strong></td>
                                            <td></td>
                                        </tr>
                                        {% if entity.dueAmount  > 0 %}
                                            <tr>
                                                <td class="numeric" colspan="6" ><span class="pull-right"><strong>Due Amount</strong></span></td>
                                                <td class="numeric" id="due" >{{ ( entity.dueAmount)|number_format }}</td>
                                                <td></td>
                                            </tr>
                                        {% endif %}
                                        {% if entity.returnAmount  > 0 %}
                                            <tr>
                                                <td class="numeric" colspan="6" ><span class="pull-right"><strong>Return Amount</strong></span></td>
                                                <td class="numeric" >{{ ( entity.returnAmount)|number_format }}</td>
                                                <td></td>
                                            </tr>
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="span4">
                                {{ form_start(paymentForm) }}
                                {{ form_row(paymentForm._token) }}
                                <div class="clearfix"></div>
                                <div class="payment-box" style="padding: 0!important;padding-left: 7px!important;padding-top: 8px!important; margin-top: 0!important;">
                                    <div class="row-fluid">
                                        <div class="span4" style="font-weight: bold; font-size: 16px">Current Credit: </div>
                                        <input type="hidden" name="outstandingHidden" id="outstandingHidden" value="{{ currentCredit }}">
                                        <input type="hidden" name="orderTotal" id="orderTotal" value="{{ entity.total }}">
                                        <div class="span6"><strong id="outstanding" style="color: red; font-weight: bold; font-size: 16px">{{ currentCredit|number_format }} Taka</strong></div>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <div class="row-fluid">
                                    <div class="span12">
                                        <div class="switch-method">
                                            {% set methods = ['Credit','Cash','Mobile','Bank'] %}
                                            {% for method in methods %}
                                                <input {% if entity.paymentMode is not empty and entity.paymentMode == method %} checked="checked" {% endif %} type="radio" id="{{ method }}" class="method-process" name="method" value="{{ method }}"/>
                                                <label  for="{{ method }}">{{ method }}</label>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <div id="cartMethod" class="bankHide">
                                    <div class="payment-box">
                                        <div class="row-fluid">
                                            <div class="span12">{{ form_widget(paymentForm.accountBank) }}</div>
                                        </div>
                                        <div class="clearfixboth"></div>
                                        <div class="row-fluid">
                                            <div class="span6">{{ form_widget(paymentForm.paymentCard) }}</div>
                                            <div class="span6">{{ form_widget(paymentForm.cardNo) }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div id="bkashMethod" class="mobileBankHide">
                                    <div class="payment-box">
                                        <div class="row-fluid">
                                            <div class="span12">{{ form_widget(paymentForm.accountMobileBank) }}</div>
                                        </div>
                                        <div class="clearfixboth"></div>
                                        <div class="row-fluid">
                                            <div class="span6">{{ form_widget(paymentForm.paymentMobile) }}</div>
                                            <div class="span6">{{ form_widget(paymentForm.transaction) }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row-fluid text-center" style="background: #bab182; padding-top: 15px; ">
                                    <div class="span6">
                                        <span class="add-on yellow label-yellow">Special Discount</span>
                                    </div>
                                    <div class="span2"></div>
                                    <div class="span4">
                                        <input type="number" max="2" id="discountCalculation" name="discountCalculation" data-id="{{ entity.id }}" data-action="{{ path('order_ajax_discount',{'id':entity.id}) }}" value="{{ entity.discountCalculation }}"  class="m-wrap span10 discount" autocomplete="off">
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <div class="row-fluid">
                                    <div class="span6"><label class="label span12">Time Period</label></div>
                                    <div class="span6">{{ form_widget(paymentForm.timePeriod) }}</div>
                                </div>
                                <div class="row-fluid text-center" style="background: #3598dc; padding-top: 15px;">
                                    <div class="span6">
                                        <span class="add-on yellow label-yellow">Due</span>
                                    </div>
                                    <div class="span2">&nbsp;</div>
                                    <div class="span4">
                                        {{ form_widget(paymentForm.receive) }}
                                    </div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span6"><label class="label span12">Process</label></div>
                                    <div class="span6">{{ form_widget(paymentForm.process) }}</div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span12">{{ form_widget(paymentForm.comment) }}</div>
                                </div>
                                 <div class="row-fluid text-center">
                                    <div class="span12">
                                        <input type="button" class="btn blue span12" name="process-order" id="process-order" value="Save">
                                    </div>
                                </div>
                                {{ form_end(paymentForm) }}
                            </div>
                        </div>
                        <div class="clearfix"> </div>


                    </div>
                </div>

            </div>
        </div>
    </div>
    <div id="payment-confirm" style="display:none; text-align: left!important;">Thank you for your payment. Your payment has been sent successfully to our customer service department.</div>
{% endblock %}
{% block cssBlock %}
    <style>
        .ui-autocomplete{
            width: 250px!important;
        }
        ul.ui-autocomplete li{
            width: 250px!important;
            display: flex;
        }
        input[class*="span"].m-wrap,select[class*="span"],select{
            border: 1px solid #0b84fe!important;
            height: 34px!important;
        }
        input[type="text"].m-wrap-custom,input[type="date"].m-wrap-custom, select.m-wrap-custom{
            border: 3px solid #0b84fe!important;
            height: 30px!important;
            padding: 5px!important;
            min-height: 25px!important;
        }
        input[type="text"].input-number{
            height: 18px!important;
            min-height: 20px!important;
            font-size: 14px;
            text-align: center;
            font-weight: bold;
            width: 120px!important;
        }
        .row-fluid textarea[class*="span"] {
            border: 1px solid #0b84fe!important;
        }
        .select2-container .select2-choice {
            border: 1px solid #0b84fe!important;
            height: 30px!important;
        }
        .label-yellow{
            text-align: right;
            font-size: 20px;
            display: block;
            font-weight: bold;
            color: wheat;
        }

    </style>
    {% stylesheets filter='cssrewrite'
        '@EcommerceBundle/Resources/public/css/style.css'
        '@EcommerceBundle/Resources/public/css/pos.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock  %}
{% block javascriptBlock %}
    {{ parent() }}
    {% javascripts
    'bundles/ecommerce/js/editable.js'
    'bundles/ecommerce/js/approveProcess.js'
    'bundles/ecommerce/js/payment.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}
{% block documentready %}
    {{ parent() }}
    EditableInit();
    ApproveProcess();

{% endblock %}
